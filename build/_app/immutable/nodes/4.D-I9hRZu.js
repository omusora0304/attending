import{l as fe,t as k,s as g,b as j,e as K,h as be}from"../chunks/CKQCreVm.js";import{i as le}from"../chunks/Bm3K0hjP.js";import{aa as he,h as me,u as _e,ab as pe,y as ne,ac as je,r as $,C as n,F as t,E as d,B as R,j as e,G as ke,ad as ye,v as r,D as ve,z as ge,A as Me,$ as $e,d as xe}from"../chunks/BVNNn7ox.js";import{i as S,s as Ee,a as De}from"../chunks/BqwgYQ-J.js";import{e as oe,i as de,a as Ve,s as we}from"../chunks/BPY4y56w.js";import{r as te,s as Ae}from"../chunks/3iK5RE0Y.js";import{b as Re,e as Se,f as Ce,h as Fe,i as Ge,s as He,G as Le}from"../chunks/B9mEG7mM.js";import{b as qe}from"../chunks/DvOeuFBO.js";import{p as ze}from"../chunks/DUUr3DC5.js";/* empty css                */import{f as Be,j as Oe}from"../chunks/DRTtKfAx.js";function se(a,f,o=f){var y=he();fe(a,"input",c=>{var i=c?a.defaultValue:a.value;if(i=Y(a)?Z(i):i,o(i),y&&i!==(i=f())){var u=a.selectionStart,v=a.selectionEnd;a.value=i??"",v!==null&&(a.selectionStart=u,a.selectionEnd=Math.min(v,a.value.length))}}),(me&&a.defaultValue!==a.value||_e(f)==null&&a.value)&&o(Y(a)?Z(a.value):a.value),pe(()=>{var c=f();Y(a)&&c===Z(a.value)||a.type==="date"&&!c&&!a.value||c!==a.value&&(a.value=c??"")})}function Y(a){var f=a.type;return f==="number"||f==="range"}function Z(a){return a===""?null:+a}function Ie(a){return function(...f){var o=f[0];return o.preventDefault(),a==null?void 0:a.apply(this,f)}}var Je=k("<option> </option>"),Ke=k('<div class="error svelte-k6917t"> </div>'),Ne=k('<button type="button" class="delete-button svelte-k6917t">削除</button>'),Pe=k('<div class="member-editor svelte-k6917t"><h3 class="svelte-k6917t"> </h3> <form><div class="form-group svelte-k6917t"><label for="name" class="svelte-k6917t">名前</label> <input type="text" id="name" placeholder="メンバー名を入力" class="svelte-k6917t"></div> <div class="form-group svelte-k6917t"><label for="grade" class="svelte-k6917t">学年</label> <select id="grade"></select></div> <div class="form-group svelte-k6917t"><label for="sortValue" class="svelte-k6917t">ソート順（オプション）</label> <input type="number" id="sortValue" placeholder="数値を入力" class="svelte-k6917t"> <div class="help-text svelte-k6917t">同じ学年内での表示順を指定します。未設定の場合は最後に表示されます。</div></div> <!> <div class="actions svelte-k6917t"><button type="submit" class="save-button svelte-k6917t"> </button> <!> <button type="button" class="cancel-button svelte-k6917t">キャンセル</button></div></form></div>');function re(a,f){var w,T,A;ne(f,!1);let o=ze(f,"member",8,null);const y=je();let c=$(((w=o())==null?void 0:w.name)||""),i=$(((T=o())==null?void 0:T.grade)||"H3"),u=$(((A=o())==null?void 0:A.sortValue)||void 0),v=$(!1),p=$("");const N=()=>{r(c,""),r(i,"H3"),r(u,void 0),r(p,"")},P=async()=>{if(!e(c).trim()){r(p,"名前を入力してください");return}r(p,""),r(v,!0);try{if(o())await Ce(o().id,e(c),e(i),e(u)),y("updated",{id:o().id,name:e(c),grade:e(i),sortValue:e(u)});else{const l=await Fe(e(c),e(i),e(u));y("created",{id:l,name:e(c),grade:e(i),sortValue:e(u)}),N()}}catch(l){console.error("Member save failed:",l),r(p,o()?"更新に失敗しました":"追加に失敗しました")}finally{r(v,!1)}},C=async()=>{if(o()&&confirm(`${o().name}を削除してもよろしいですか？`)){r(v,!0);try{await Se(o().id),y("deleted",{id:o().id})}catch(l){console.error("Member delete failed:",l),r(p,"削除に失敗しました")}finally{r(v,!1)}}},F=()=>{y("cancel"),N()};le();var G=Pe(),H=n(G),Q=n(H,!0);t(H);var L=d(H,2),x=n(L),q=d(n(x),2);te(q),t(x);var E=d(x,2),D=d(n(E),2);R(()=>{e(i),ke(()=>{e(v)})}),oe(D,5,()=>Re,de,(l,b)=>{var m=Je(),U={},J=n(m,!0);t(m),R(()=>{U!==(U=e(b))&&(m.value=(m.__value=e(b))??""),g(J,e(b))}),j(l,m)}),t(D),t(E);var z=d(E,2),B=d(n(z),2);te(B),ye(2),t(z);var s=d(z,2);{var _=l=>{var b=Ke(),m=n(b,!0);t(b),R(()=>g(m,e(p))),j(l,b)};S(s,l=>{e(p)&&l(_)})}var O=d(s,2),M=n(O),W=n(M,!0);t(M);var h=d(M,2);{var I=l=>{var b=Ne();R(()=>b.disabled=e(v)),K("click",b,C),j(l,b)};S(h,l=>{o()&&l(I)})}var V=d(h,2);t(O),t(L),t(G),R(()=>{g(Q,o()?"メンバー編集":"メンバー追加"),q.disabled=e(v),D.disabled=e(v),B.disabled=e(v),M.disabled=e(v),g(W,e(v)?"処理中...":o()?"更新":"追加"),V.disabled=e(v)}),se(q,()=>e(c),l=>r(c,l)),qe(D,()=>e(i),l=>r(i,l)),se(B,()=>e(u),l=>r(u,l)),K("click",V,F),K("submit",L,Ie(P)),j(a,G),ve()}var Qe=k('<button class="add-button svelte-enjfha">新しいメンバーを追加</button>'),Te=k('<p class="empty-message svelte-enjfha">メンバーがいません</p>'),Ue=k('<tr><td class="svelte-enjfha"><span class="grade-badge svelte-enjfha"> </span></td><td class="svelte-enjfha"> </td><td class="svelte-enjfha"><span> </span></td><td class="svelte-enjfha"> </td><td class="actions-cell svelte-enjfha"><button class="edit-button svelte-enjfha">編集</button> <a class="view-link svelte-enjfha">詳細</a></td></tr>'),We=k('<div class="members-table-container svelte-enjfha"><table class="members-table svelte-enjfha"><thead><tr><th class="svelte-enjfha">学年</th><th class="svelte-enjfha">名前</th><th class="svelte-enjfha">状態</th><th class="svelte-enjfha">最終更新</th><th class="svelte-enjfha">アクション</th></tr></thead><tbody></tbody></table></div>'),Xe=k('<div class="members-admin-page svelte-enjfha"><header class="header svelte-enjfha"><h1 class="svelte-enjfha">メンバー管理</h1> <div class="header-links svelte-enjfha"><a href="/" class="back-link svelte-enjfha">トップに戻る</a> <a href="/admin" class="back-link svelte-enjfha">管理画面に戻る</a></div></header> <div class="page-actions svelte-enjfha"><!></div> <!> <!> <section class="members-section svelte-enjfha"><h2 class="svelte-enjfha">メンバー一覧</h2> <!></section></div>');function da(a,f){ne(f,!1);const[o,y]=Ee(),c=()=>De(He,"$sortedMembers",o);let i,u=$(null),v=$(!1);const p=s=>{r(u,s),r(v,!1)},N=()=>{r(u,null),r(v,!0)},P=()=>{r(u,null),r(v,!1)};ge(()=>{i=Ge()}),Me(()=>{i&&i()}),le();var C=Xe();be(s=>{$e.title="メンバー管理 | 滞在管理システム"});var F=d(n(C),2),G=n(F);{var H=s=>{var _=Qe();K("click",_,N),j(s,_)};S(G,s=>{e(v)||s(H)})}t(F);var Q=d(F,2);{var L=s=>{re(s,{$$events:{created:()=>{r(v,!1)},cancel:P}})};S(Q,s=>{e(v)&&s(L)})}var x=d(Q,2);{var q=s=>{re(s,{get member(){return e(u)},$$events:{updated:()=>{r(u,null)},deleted:()=>{r(u,null)},cancel:P}})};S(x,s=>{e(u)&&s(q)})}var E=d(x,2),D=d(n(E),2);{var z=s=>{var _=Te();j(s,_)},B=s=>{var _=We(),O=n(_),M=d(n(O));oe(M,5,c,de,(W,h)=>{var I=Ue(),V=n(I),w=n(V),T=n(w,!0);t(w),t(V);var A=d(V),l=n(A,!0);t(A);var b=d(A),m=n(b),U=n(m,!0);t(m),t(b);var J=d(b),ie=n(J,!0);t(J);var ee=d(J),X=n(ee),ce=d(X,2);t(ee),t(I),R(ue=>{var ae;Ve(w,`background-color: ${Le[e(h).grade]??""}`),g(T,e(h).grade),g(l,e(h).name),we(m,1,`status-badge ${e(h).status??""}`,"svelte-enjfha"),g(U,e(h).status==="in"?"入室中":"退室中"),g(ie,ue),X.disabled=((ae=e(u))==null?void 0:ae.id)===e(h).id,Ae(ce,"href",`/member/${e(h).id??""}`)},[()=>Be(e(h).lastStatusChange,"yyyy/MM/dd HH:mm",{locale:Oe})],xe),K("click",X,()=>p(e(h))),j(W,I)}),t(M),t(O),t(_),j(s,_)};S(D,s=>{c().length===0?s(z):s(B,!1)})}t(E),t(C),j(a,C),ve(),y()}export{da as component};
