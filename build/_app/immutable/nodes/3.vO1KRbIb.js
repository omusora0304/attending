import{t as _,h as ce,e as G,b as u,s as p}from"../chunks/CKQCreVm.js";import{i as ve}from"../chunks/Bm3K0hjP.js";import{y as me,z as fe,A as ue,B as h,C as l,j as s,D as pe,$ as _e,d as B,E as r,F as a,r as J,G as be,v as c}from"../chunks/BVNNn7ox.js";import{i as he,s as ge,a as ye}from"../chunks/BqwgYQ-J.js";import{e as K,i as N,s as Q,c as $e,a as ke}from"../chunks/BPY4y56w.js";import{s as we}from"../chunks/3iK5RE0Y.js";import{b as xe}from"../chunks/DvOeuFBO.js";import{s as Me,i as Se,u as O,G as Ae}from"../chunks/Ddin1ii5.js";import{a as R}from"../chunks/C0v4optL.js";import{f as Fe,j as je}from"../chunks/DRTtKfAx.js";var Ce=_("<option> </option>"),De=_('<p class="empty-message svelte-3dfe7m">メンバーがいません</p>'),Ge=_('<tr><td class="svelte-3dfe7m"><span class="grade-badge svelte-3dfe7m"> </span></td><td class="svelte-3dfe7m"> </td><td class="svelte-3dfe7m"><span> </span></td><td class="svelte-3dfe7m"> </td><td class="svelte-3dfe7m"><a class="view-link svelte-3dfe7m">詳細</a></td></tr>'),Oe=_('<div class="members-table-container svelte-3dfe7m"><table class="members-table svelte-3dfe7m"><thead><tr><th class="svelte-3dfe7m">学年</th><th class="svelte-3dfe7m">名前</th><th class="svelte-3dfe7m">状態</th><th class="svelte-3dfe7m">最終更新</th><th class="svelte-3dfe7m">アクション</th></tr></thead><tbody></tbody></table></div>'),Re=_('<div class="admin-page svelte-3dfe7m"><header class="header svelte-3dfe7m"><h1 class="svelte-3dfe7m">管理画面</h1> <div class="header-links svelte-3dfe7m"><a href="/" class="back-link svelte-3dfe7m">トップに戻る</a> <a href="/admin/members" class="nav-link svelte-3dfe7m">メンバー管理</a> <a href="/admin/stats" class="nav-link svelte-3dfe7m">統計</a></div></header> <div class="admin-actions svelte-3dfe7m"><section class="action-section svelte-3dfe7m"><h2 class="svelte-3dfe7m">一括操作</h2> <div class="action-buttons svelte-3dfe7m"><button class="out-button svelte-3dfe7m">全員退室</button> <button class="in-button svelte-3dfe7m">全員入室</button></div></section> <section class="action-section svelte-3dfe7m"><h2 class="svelte-3dfe7m">個別操作</h2> <div class="member-selector svelte-3dfe7m"><select class="svelte-3dfe7m"><option>メンバーを選択...</option><!></select> <button class="toggle-button svelte-3dfe7m">状態を切り替え</button></div></section></div> <section class="members-section svelte-3dfe7m"><h2 class="svelte-3dfe7m">メンバー状態</h2> <!></section></div>');function Ne(T,U){me(U,!1);const[V,W]=ge(),o=()=>ye(Me,"$sortedMembers",V);let g,i=J(!1),v=J("");const X=async()=>{if(confirm("全員を退室状態に変更しますか？")){c(i,!0);try{const e=o().filter(t=>t.status==="in").map(async t=>{await R(t.id,"out"),await O(t.id,"out")});await Promise.all(e)}catch(e){console.error("Failed to set all members out:",e),alert("処理に失敗しました")}finally{c(i,!1)}}},Y=async()=>{if(confirm("全員を入室状態に変更しますか？")){c(i,!0);try{const e=o().filter(t=>t.status==="out").map(async t=>{await R(t.id,"in"),await O(t.id,"in")});await Promise.all(e)}catch(e){console.error("Failed to set all members in:",e),alert("処理に失敗しました")}finally{c(i,!1)}}},Z=async()=>{if(!s(v)){alert("メンバーを選択してください");return}const e=o().find(t=>t.id===s(v));if(e){c(i,!0);try{const t=e.status==="in"?"out":"in";await R(e.id,t),await O(e.id,t)}catch(t){console.error("Failed to toggle member status:",t),alert("処理に失敗しました")}finally{c(i,!1)}}};fe(()=>{g=Se()}),ue(()=>{g&&g()}),ve();var y=Re();ce(e=>{_e.title="管理画面 | 滞在管理システム"});var $=r(l(y),2),k=l($),E=r(l(k),2),w=l(E),H=r(w,2);a(E),a(k);var I=r(k,2),L=r(l(I),2),m=l(L);h(()=>{s(v),be(()=>{s(i),o()})});var x=l(m);x.value=x.__value="";var ee=r(x);K(ee,1,o,N,(e,t)=>{var d=Ce(),f={},M=l(d);a(d),h(()=>{f!==(f=s(t).id)&&(d.value=(d.__value=s(t).id)??""),p(M,`${s(t).name??""} (${s(t).status==="in"?"入室中":"退室中"})`)}),u(e,d)}),a(m);var P=r(m,2);a(L),a(I),a($);var q=r($,2),te=r(l(q),2);{var se=e=>{var t=De();u(e,t)},ae=e=>{var t=Oe(),d=l(t),f=r(l(d));K(f,5,o,N,(M,n)=>{var b=Ge(),S=l(b),A=l(S),le=l(A,!0);a(A),a(S);var F=r(S),re=l(F,!0);a(F);var j=r(F),C=l(j),ie=l(C,!0);a(C),a(j);var D=r(j),oe=l(D,!0);a(D);var z=r(D),de=l(z);a(z),a(b),h(ne=>{Q(b,1,$e(s(n).status),"svelte-3dfe7m"),ke(A,`background-color: ${Ae[s(n).grade]??""}`),p(le,s(n).grade),p(re,s(n).name),Q(C,1,`status-badge ${s(n).status??""}`,"svelte-3dfe7m"),p(ie,s(n).status==="in"?"入室中":"退室中"),p(oe,ne),we(de,"href",`/member/${s(n).id??""}`)},[()=>Fe(s(n).lastStatusChange,"MM/dd HH:mm",{locale:je})],B),u(M,b)}),a(f),a(d),a(t),u(e,t)};he(te,e=>{o().length===0?e(se):e(ae,!1)})}a(q),a(y),h((e,t)=>{w.disabled=e,H.disabled=t,m.disabled=s(i),P.disabled=s(i)||!s(v)},[()=>s(i)||o().every(e=>e.status==="out"),()=>s(i)||o().every(e=>e.status==="in")],B),G("click",w,X),G("click",H,Y),xe(m,()=>s(v),e=>c(v,e)),G("click",P,Z),u(T,y),pe(),W()}export{Ne as component};
